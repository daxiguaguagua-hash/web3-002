# 极简风格家庭/个人财务记账APP — 测试文档（v1.4 最终锁定版）

版本：v1.4（锁定：汇率弹窗模态、隐私导出完全禁止、离线验证首选mock时钟、Child当日删除occurred_local_date判定）
覆盖版本：V1.0

---

## 1. 测试范围与不测范围

### 1.1 测试范围

- 交易：新增/编辑/软删即时一致性
- 多币种：汇率缓存滑动24h、无缓存1:1+模态弹窗
- 转账：仅同币种；跨币种禁止
- 家庭权限：矩阵一致性；Child可见性+当日删除（occurred_local_date）
- 安全：隐私解锁PIN fallback；隐私账本不云同步、不导出分享
- 离线：7×24小时保持（首选mock时钟验证）
- Web演示：无真实数据请求、抓包审计

### 1.2 不测范围

- Web端真实功能
- 银行同步
- 投资理财

---

## 2. 测试环境

- 标准设备：iPhone 12 / iOS 15+；Android 11+（骁龙778G级）
- 网络：Wi-Fi / 4G/5G / 飞行模式
- 数据集：100条 / 10,000条（性能） / 100,000条（探索）

---

## 3. 验收标准（关键KPI）

- 5秒一笔：P95≤5秒
- 离线可靠：7×24小时可见（首选mock时钟验证）
- 多币种不漂移：历史使用快照
- base_currency不可改
- 权限矩阵一致
- 隐私解锁：失败3次→PIN；无生物识别→PIN
- 隐私账本：不云同步、不导出分享
- 软删：立即从所有视图排除，余额/报表/预算即时回滚
- Web：首屏<3秒；无真实请求

---

## 4. 核心测试用例（仅列关键更新点）

### 4.1 交易

**TC-TX-004 软删即时一致性**

- 期望：删除后立即从列表/报表/余额/预算排除，无幽灵记录

### 4.2 多币种与汇率

**TC-FX-002 汇率失败且无缓存回退**

- 期望：
  1. fx_rate_to_base=1，fx_source=manual
  2. 保存时弹出**模态Alert**，文案匹配PRD
  3. 用户必须确认后才保存完成

### 4.3 家庭与权限

**TC-CHILD-002 Child当日删除（时区稳定性）**

- 前置：创建交易时记录 occurred_local_date
- 步骤：创建今天/昨天交易 → 切换时区后重复校验
- 期望：删除权限严格依 occurred_local_date，不受当前时区影响

### 4.4 安全与隐私

**TC-SEC-003 隐私账本不云同步 + 不导出分享**

- 步骤：开启同步 + 尝试导出/分享隐私账本
- 期望：另一设备不可见；无导出/分享入口或功能被禁用

### 4.5 离线

**TC-OFF-002 离线7×24小时保持**

- **首选方法**：自动化mock时钟（注入虚拟时间前进7×24h + 断言数据可见性）
- 备选：长跑环境日志监控
- 期望：达到阈值仍可见，无异常

### 4.6 Web演示

**TC-WEB-003 无真实数据请求**

- 方法：Burp/Charles抓包审计
- 期望：无登录、无账本/交易API请求

---

## 5. 上线前必须审计Checklist

### 5.1 隐私账本不同步 & 不导出

- [ ] 同步模块硬编码过滤隐私表/字段（有单测）
- [ ] 导出/分享功能在隐私账本完全禁用（无入口、无API）
- [ ] 自动化用例：换设备/尝试导出 → 断言不可见/不可操作

### 5.2 Web演示

- [ ] 抓包无真实请求
- [ ] 静态资源版本控制明确

### 5.3 多币种保护

- [ ] fx_rate_to_base / base_currency 不可编辑/修改
- [ ] 关键计算高精度统一
